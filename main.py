#!/usr/bin/env python3# -- coding: utf-8 --import telebotfrom telebot import typesimport osimport uuidimport difflibimport jsonimport time# ----------------- CONFIG -----------------TOKEN = "7838934497:AAE6HTUFS0egO3vT1W1lgeRnJTgqDRDy1Hw"┬а┬а # <-- ржПржЦрж╛ржирзЗ ржЖржкржирж╛рж░ ржмржЯ TOKEN ржмрж╕рж╛ржмрзЗржиOWNER_ID = 5880876410┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # ржорж╛рж▓рж┐ржХрзЗрж░ ржЖржЗржбрж┐ (ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржмржжрж▓рж╛рждрзЗ ржкрж╛рж░рзЗржи)CHANNELS = ["fojikmovie", "fojikmovie"]┬а # ржЪрзНржпрж╛ржирзЗрж▓ ржЗржЙржЬрж╛рж░ржирзЗржо (without @)# ------------------------------------------bot = telebot.TeleBot(TOKEN)# ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржУ ржЗржЙржЬрж╛рж░ ржлрж╛ржЗрж▓ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛if not os.path.exists("files"):┬а┬а┬а os.mkdir("files")USER_FILE = "users.txt"# ----------------- HELPERS -----------------def save_user(user_id):┬а┬а┬а """Unique user id рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ"""┬а┬а┬а if not os.path.exists(USER_FILE):┬а┬а┬а┬а┬а┬а┬а with open(USER_FILE, "w", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а f.write("")┬а┬а┬а with open(USER_FILE, "r", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а users = f.read().splitlines()┬а┬а┬а if str(user_id) not in users:┬а┬а┬а┬а┬а┬а┬а with open(USER_FILE, "a", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а f.write(str(user_id) + "\n")def save_post(files_list, title):┬а┬а┬а """┬а┬а┬а files_list: list of dicts like {"ftype":"photo","file_id": "...", "text": "..."(optional)}┬а┬а┬а title: post title┬а┬а┬а Returns code┬а┬а┬а """┬а┬а┬а uid = str(uuid.uuid4())[:8]┬а┬а┬а folder = os.path.join("files", uid)┬а┬а┬а os.mkdir(folder)┬а┬а┬а data = {"title": title, "files": files_list, "created_at": int(time.time())}┬а┬а┬а with open(os.path.join(folder, "data.json"), "w", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а json.dump(data, f, ensure_ascii=False, indent=2)┬а┬а┬а return uiddef load_post(code):┬а┬а┬а folder = os.path.join("files", code)┬а┬а┬а path = os.path.join(folder, "data.json")┬а┬а┬а if not os.path.exists(path):┬а┬а┬а┬а┬а┬а┬а return None┬а┬а┬а with open(path, "r", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а return json.load(f)def send_group(chat_id, data):┬а┬а┬а """┬а┬а┬а Send a group of files saved under one post.┬а┬а┬а Caption (title) will be added to the first sent item.┬а┬а┬а """┬а┬а┬а title = data.get("title", "")┬а┬а┬а files = data.get("files", [])┬а┬а┬а # Try to send photos as albums if possible (telegram allows up to 10 photos per album).┬а┬а┬а # We'll gather consecutive photos into an album for nicer UX.┬а┬а┬а i = 0┬а┬а┬а sent_first_caption = False┬а┬а┬а while i < len(files):┬а┬а┬а┬а┬а┬а┬а item = files[i]┬а┬а┬а┬а┬а┬а┬а ftype = item.get("ftype")┬а┬а┬а┬а┬а┬а┬а fid = item.get("file_id")┬а┬а┬а┬а┬а┬а┬а # Collect a block of photos (up to 10)┬а┬а┬а┬а┬а┬а┬а if ftype == "photo":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а photos = []┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а j = i┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а while j < len(files) and files[j].get("ftype") == "photo" and len(photos) < 10:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а photos.append(files[j].get("file_id"))┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а j += 1┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # build media list for send_media_group┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а media = []┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а for idx, file_id in enumerate(photos):┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а caption = title if (not sent_first_caption and idx == 0) else None┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а media.append(types.InputMediaPhoto(file_id, caption=caption))┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_media_group(chat_id, media)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а sent_first_caption = True┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а except Exception as e:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # fallback: send one by one┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а for idx, file_id in enumerate(photos):┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а cap = title if (not sent_first_caption and idx == 0) else None┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_photo(chat_id, file_id, caption=cap)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а sent_first_caption = True┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а except Exception as e2:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а print("error sending photo fallback:", e2)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а i = j┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а continue┬а┬а┬а┬а┬а┬а┬а # Non-photo items (video/document/text), send individually┬а┬а┬а┬а┬а┬а┬а cap = title if not sent_first_caption else None┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а if ftype == "video":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_video(chat_id, fid, caption=cap)elif ftype == "document":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_document(chat_id, fid, caption=cap)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а elif ftype == "text":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # text stored directly in item["text"]┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а text_content = item.get("text", "")┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а msg = f"{title}\n\n{text_content}" if (not sent_first_caption and title) else text_content┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_message(chat_id, msg)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # unknown type: try as document┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_document(chat_id, fid, caption=cap)┬а┬а┬а┬а┬а┬а┬а except Exception as e:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а print("Error sending item:", e)┬а┬а┬а┬а┬а┬а┬а sent_first_caption = True┬а┬а┬а┬а┬а┬а┬а i += 1def is_user_member(user_id, channel_username):┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а member = bot.get_chat_member(f"@{channel_username}", user_id)┬а┬а┬а┬а┬а┬а┬а return member.status in ["member", "administrator", "creator"]┬а┬а┬а except Exception as e:┬а┬а┬а┬а┬а┬а┬а # could be privacy or bot not admin тАФ treat as not member┬а┬а┬а┬а┬а┬а┬а return Falsedef send_join_message(user_id, firstname):┬а┬а┬а markup = types.InlineKeyboardMarkup(row_width=2)┬а┬а┬а btns = [┬а┬а┬а┬а┬а┬а┬а types.InlineKeyboardButton("Join Channel 1", url=f"https://t.me/{CHANNELS[0]}"),┬а┬а┬а┬а┬а┬а┬а types.InlineKeyboardButton("Join Channel 2", url=f"https://t.me/{CHANNELS[1]}"),┬а┬а┬а┬а┬а┬а┬а types.InlineKeyboardButton("тЬЕ Joined", callback_data="joined")┬а┬а┬а ]┬а┬а┬а markup.add(btns)┬а┬а┬а text = f"Hey {firstname}\n\nPlease join all update channels to use the bot!*"┬а┬а┬а bot.send_message(user_id, text, parse_mode="Markdown", reply_markup=markup)# -------------- COMMANDS & HANDLERS --------------@bot.message_handler(commands=["start"])def start(message):┬а┬а┬а user_id = message.chat.id┬а┬а┬а firstname = message.from_user.first_name or "friend"┬а┬а┬а args = message.text.split()┬а┬а┬а # if start with code -> send the post group┬а┬а┬а if len(args) > 1:┬а┬а┬а┬а┬а┬а┬а code = args[1].strip()┬а┬а┬а┬а┬а┬а┬а data = load_post(code)┬а┬а┬а┬а┬а┬а┬а if data:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # check join requirement┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а if all(is_user_member(user_id, ch) for ch in CHANNELS):┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а send_group(user_id, data)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а save_user(user_id)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а send_join_message(user_id, firstname)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а # normal start┬а┬а┬а if all(is_user_member(user_id, ch) for ch in CHANNELS):┬а┬а┬а┬а┬а┬а┬а bot.send_message(user_id, f"тЬЕ Welcome {firstname}!")┬а┬а┬а┬а┬а┬а┬а save_user(user_id)┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а send_join_message(user_id, firstname)@bot.callback_query_handler(func=lambda call: call.data == "joined")def check_joined(call):┬а┬а┬а user_id = call.message.chat.id┬а┬а┬а firstname = call.from_user.first_name or "friend"┬а┬а┬а if all(is_user_member(user_id, ch) for ch in CHANNELS):┬а┬а┬а┬а┬а┬а┬а bot.send_message(user_id, f"тЬЕ Thank you {firstname}! You can now use the bot.")┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а bot.send_message(user_id, "тЪая╕П Please join both channels first!")# ---------------- UPLOAD (ONE POST = MULTIPLE FILES, ONE LINK) ----------------@bot.message_handler(commands=["upload"])def upload_cmd(message):┬а┬а┬а if message.chat.id != OWNER_ID:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЭМ рж╢рзБржзрзБржорж╛рждрзНрж░ ржорж╛рж▓рж┐ржХ ржПржЗ ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а bot.reply_to(message,┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а "ЁЯУд ржПржЦржи ржПржХ ржкрзЛрж╕рзНржЯрзЗрж░ рж╕ржм ржлрж╛ржЗрж▓ ржкрж╛ржарж╛ржи (ржЫржмрж┐/ржнрж┐ржбрж┐ржУ/ржбржХрзБржорзЗржирзНржЯ/ржЯрзЗржХрзНрж╕ржЯ)ред\n"┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а "ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗ ржХрзНржпрж╛ржкрж╢ржи рж▓рж┐ржЦрзЗ ржжрж┐рж▓рзЗ рж╕рзЗржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ ржЯрзЗржХрж╕рзНржЯ рж╣рж┐рж╕рзЗржмрзЗ ржзрж░рж╛ рж╣ржмрзЗ (ржкрзНрж░ржержо ржХрзНржпрж╛ржкрж╢ржи рж╣ржмрзЗ ржЯрж╛ржЗржЯрзЗрж▓)ред\n\n"┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а "рж╕ржм ржлрж╛ржЗрж▓ ржкрж╛ржарж╛ржирзЛ рж╢рзЗрж╖ рж╣рж▓рзЗ /done рж▓рж┐ржЦрзБржиред\n"┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а "ржХрзЛржирзЛ рж╕ржорзЯ /cancel рж▓рж┐ржЦрзЗ ржХрзНржпрж╛ржирж╕рзЗрж▓ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред")┬а┬а┬а # рж╢рзБрж░рзБрждрзЗ ржЦрж╛рж▓рж┐ рждрж╛рж▓рж┐ржХрж╛ ржУ None title ржкрж╛ржарж╛ржмрзЛ┬а┬а┬а bot.register_next_step_handler(message, collect_post_files, [], None)def collect_post_files(message, collected, title):┬а┬а┬а # cancel┬а┬а┬а if message.text and message.text.strip().lower() == "/cancel":┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЭМ ржЖржкрж▓рзЛржб ржХрзНржпрж╛ржирж╕рзЗрж▓ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а # finish┬а┬а┬а if message.text and message.text.strip().lower() == "/done":if not collected:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЪая╕П ржХрзЛржирзЛ ржлрж╛ржЗрж▓ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐!")┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а┬а┬а┬а┬а if not title:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # if owner sent some captions earlier maybe title None; fallback┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а title = "Untitled Post"┬а┬а┬а┬а┬а┬а┬а code = save_post(collected, title)┬а┬а┬а┬а┬а┬а┬а link = f"https://t.me/{bot.get_me().username}?start={code}"┬а┬а┬а┬а┬а┬а┬а bot.send_message(message.chat.id,┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а f"тЬЕ ржкрзЛрж╕рзНржЯ ржЖржкрж▓рзЛржб рж╕ржорзНржкржирзНржи!\nЁЯОм ржЯрж╛ржЗржЯрзЗрж▓: {title}\nЁЯФЧ рж▓рж┐ржВржХ: {link}\n\n"┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а f"ржХрзЛржб: {code}")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а # first non-/done input could be text; treat accordingly┬а┬а┬а # set title if not set and message has caption or text┬а┬а┬а # handle different content types┬а┬а┬а ftype = None┬а┬а┬а entry = None┬а┬а┬а if message.content_type == "photo":┬а┬а┬а┬а┬а┬а┬а ftype = "photo"┬а┬а┬а┬а┬а┬а┬а fid = message.photo[-1].file_id┬а┬а┬а┬а┬а┬а┬а entry = {"ftype": "photo", "file_id": fid}┬а┬а┬а┬а┬а┬а┬а # use caption of the photo as title if not set┬а┬а┬а┬а┬а┬а┬а if not title and message.caption:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а title = message.caption┬а┬а┬а elif message.content_type == "video":┬а┬а┬а┬а┬а┬а┬а ftype = "video"┬а┬а┬а┬а┬а┬а┬а fid = message.video.file_id┬а┬а┬а┬а┬а┬а┬а entry = {"ftype": "video", "file_id": fid}┬а┬а┬а┬а┬а┬а┬а if not title and message.caption:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а title = message.caption┬а┬а┬а elif message.content_type == "document":┬а┬а┬а┬а┬а┬а┬а ftype = "document"┬а┬а┬а┬а┬а┬а┬а fid = message.document.file_id┬а┬а┬а┬а┬а┬а┬а name = message.document.file_name┬а┬а┬а┬а┬а┬а┬а entry = {"ftype": "document", "file_id": fid, "file_name": name}┬а┬а┬а┬а┬а┬а┬а if not title and message.caption:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а title = message.caption┬а┬а┬а elif message.content_type == "text":┬а┬а┬а┬а┬а┬а┬а # If message is plain text and title not yet set, treat it as title (but allow multiple text entries)┬а┬а┬а┬а┬а┬а┬а txt = message.text.strip()┬а┬а┬а┬а┬а┬а┬а if not title:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а title = txt┬а # first plain text becomes title┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, f"тЬФ ржЯрж╛ржЗржЯрзЗрж▓ рж╕рзЗржЯ ржХрж░рж╛ рж╣рж▓рзЛ: {title}\nржПржЦржи ржлрж╛ржЗрж▓ ржкрж╛ржарж╛ржи ржЕржержмрж╛ /done рж▓рж┐ржЦрзБржиред")┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.register_next_step_handler(message, collect_post_files, collected, title)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а┬а┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а # store text block as a text file entry┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а entry = {"ftype": "text", "text": txt}┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЪая╕П рж╢рзБржзрзБ ржЫржмрж┐, ржнрж┐ржбрж┐ржУ, ржбржХрзБржорзЗржирзНржЯ ржмрж╛ ржЯрзЗржХрзНрж╕ржЯ ржкрж╛ржарж╛ржиред")┬а┬а┬а┬а┬а┬а┬а bot.register_next_step_handler(message, collect_post_files, collected, title)┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а # append entry if prepared┬а┬а┬а if entry:┬а┬а┬а┬а┬а┬а┬а collected.append(entry)┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "ЁЯУе ржлрж╛ржЗрж▓ ржпрзЛржЧ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ тАФ ржЖрж░ржУ ржкрж╛ржарж╛рждрзЗ ржкрж╛рж░рзЗржи, рж╢рзЗрж╖ рж╣рж▓рзЗ /done рж▓рж┐ржЦрзБржиред")┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЪая╕П ржХрж┐ржЫрзБ ржмрзБржЭрждрзЗ ржкрж╛рж░рж┐ржирж┐ тАФ ржЖржмрж╛рж░ ржкрж╛ржарж╛ржиред")┬а┬а┬а bot.register_next_step_handler(message, collect_post_files, collected, title)# ---------------- BROADCAST ----------------@bot.message_handler(commands=["broadcast"])def broadcast_cmd(message):┬а┬а┬а if message.chat.id != OWNER_ID:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЭМ ржЖржкржирж┐ ржПржЗ ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ред")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а bot.reply_to(message, "ЁЯУв ржпрж╛ ржкрж╛ржарж╛ржмрзЗржи, рж╕рзЗржЯрж╛ рж╕ржмрж╛рж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ тАФ ржПржЦржи ржпрж╛ ржкрж╛ржарж╛ржмрзЗржиржУржЗ ржкрж╛ржарж╛ржи:")┬а┬а┬а bot.register_next_step_handler(message, do_broadcast)def do_broadcast(message):┬а┬а┬а if not os.path.exists(USER_FILE):┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЭМ ржХрзЛржирзЛ ржЗржЙржЬрж╛рж░ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐!")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а with open(USER_FILE, "r", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а users = f.read().splitlines()┬а┬а┬а sent = 0┬а┬а┬а failed = 0┬а┬а┬а for uid in users:┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а if message.content_type == "text":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_message(uid, message.text)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а elif message.content_type == "photo":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_photo(uid, message.photo[-1].file_id, caption=message.caption)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а elif message.content_type == "video":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_video(uid, message.video.file_id, caption=message.caption)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а elif message.content_type == "document":┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а bot.send_document(uid, message.document.file_id, caption=message.caption)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а sent += 1┬а┬а┬а┬а┬а┬а┬а except Exception:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а failed += 1┬а┬а┬а bot.send_message(OWNER_ID, f"ЁЯУи Broadcast рж╕ржорзНржкржирзНржи!\nтЬФ рж╕ржлрж▓: {sent}\nтЭМ ржмрзНржпрж░рзНрже: {failed}")# ---------------- DELETE POST ----------------@bot.message_handler(commands=["delete"])def delete_cmd(message):┬а┬а┬а if message.chat.id != OWNER_ID:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "тЭМ ржЖржкржирж┐ ржПржЗ ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ред")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а parts = message.text.split()┬а┬а┬а if len(parts) < 2:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, "ЁЯЧСя╕П ржмрзНржпржмрж╣рж╛рж░: /delete <code>")┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а code = parts[1].strip()┬а┬а┬а folder = os.path.join("files", code)┬а┬а┬а if os.path.exists(folder) and os.path.isdir(folder):┬а┬а┬а┬а┬а┬а┬а # remove files inside then folder┬а┬а┬а┬а┬а┬а┬а for fname in os.listdir(folder):┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а os.remove(os.path.join(folder, fname))┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а except Exception:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а pass┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а os.rmdir(folder)┬а┬а┬а┬а┬а┬а┬а except Exception:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а pass┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, f"тЬЕ ржкрзЛрж╕рзНржЯ {code} ржбрж┐рж▓рж┐ржЯ рж╣рзЯрзЗржЫрзЗред")┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а bot.reply_to(message, f"тЭМ ржкрзЛрж╕рзНржЯ {code} ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред")# ---------------- SMART SEARCH (user messages) ----------------@bot.message_handler(func=lambda m: True)def smart_search_handler(message):┬а┬а┬а # ignore commands┬а┬а┬а if message.text and message.text.startswith("/"):┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а query = (message.text or "").strip().lower()┬а┬а┬а if not query:┬а┬а┬а┬а┬а┬а┬а return┬а┬а┬а best = None┬а┬а┬а best_ratio = 0.0┬а┬а┬а # iterate over every post folder┬а┬а┬а for fname in os.listdir("files"):┬а┬а┬а┬а┬а┬а┬а folder = os.path.join("files", fname)┬а┬а┬а┬а┬а┬а┬а data_file = os.path.join(folder, "data.json")┬а┬а┬а┬а┬а┬а┬а if os.path.exists(data_file):┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а try:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а with open(data_file, "r", encoding="utf-8") as f:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а data = json.load(f)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а except Exception:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а continue┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а title = (data.get("title") or "").lower()┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а ratio = difflib.SequenceMatcher(None, query, title).ratio()┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а if query in title or ratio > 0.55:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а if ratio > best_ratio:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а best_ratio = ratio┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а best = (fname, data)┬а┬а┬а if best:┬а┬а┬а┬а┬а┬а┬а code, data = best┬а┬а┬а┬а┬а┬а┬а # check join requirement┬а┬а┬а┬а┬а┬а┬а if all(is_user_member(message.chat.id, ch) for ch in CHANNELS):┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а send_group(message.chat.id, data)┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а save_user(message.chat.id)┬а┬а┬а┬а┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а send_join_message(message.chat.id, message.from_user.first_name or "friend")┬а┬а┬а else:┬а┬а┬а┬а┬а┬а┬а # no match тАФ ask join (keeps previous behavior)┬а┬а┬а┬а┬а┬а┬а send_join_message(message.chat.id, message.from_user.first_name or "friend")# ---------------- START POLLING ----------------if name == "main":┬а┬а┬а print("ЁЯдЦ Bot is running...")┬а┬а┬а bot.infinity_polling()
